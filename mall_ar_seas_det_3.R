library(TSA)
ma <- read.table(file="C:\\pruebas_r\\mall_ar_diario.dat", header=FALSE)
maa<-ma[2921:4626,1]
maa <-matrix(data=maa,ncol=1)
mall <- ts(maa, start = c(2003, 1), frequency = 365)
plot(log(mall))
t=seq(1,nrow(mall))
det_seas=cos(0*t)
for (j in 1:182) {det_seas=cbind(det_seas,cos(2*pi*t*j/365),sin(2*pi*t*j/365))}
end1 <-log(mall)
exo1 <-det_seas
rho <-solve(t(exo1)%*%exo1)%*%(t(exo1)%*%end1)
mal_e=log(mall)-exo1%*%rho
mal_f=exo1%*%rho
mall_e <- ts(mal_e, start = c(2003, 1), frequency = 365)
mall_f <- ts(mal_f, start = c(2003, 1), frequency = 365)
ser=cbind(log(mall),mall_e,mall_f)
ts.plot(log(mall),mall_f,col=1:2)
acf(mall_e,lag.max=28)
pacf(mall_e,lag.max=28)
acf(diff(mall_e,7),lag.max=28)
pacf(diff(mall_e,7),lag.max=28)
m1=arima(mall_e,order=c(2,0,1),seasonal = list(order = c(0,1,1), period = 7))
res_m1<-reasiduals(m1)
tsdiag(m1)
detectAO(m1)
detectIO(m1)
res_m1 <-residuals(m1)
acf(res_m1,lag.max=28)
pacf(res_m1,lag.max=28)

m2=arimax(mall_e,order=c(2,0,1),seasonal = list(order = c(0, 1, 1), period = 7),io=c(463,724,1097,1997,4375))
m3=arimax(mall_e,order=c(2,0,1),seasonal = list(order = c(1, 1, 1), period = 7),io=c(463,724,1097,1997,4375), xreg=data.frame(D1040=1*(seq(mall_e)==1040),d1403=1*(seq(mall_e)==1403)))
tsdiag(m3)
res_m3=residuals(m3)
acf(res_m3,lag.max=28)
mall_e_fit<-fitted(m3)
ts.plot(mall_e,mall_e_fit,col=1:2)
